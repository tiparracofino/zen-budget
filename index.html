<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>é–“ â€” Ma Budget</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Zen+Kaku+Gothic+New:wght@300;400&display=swap" rel="stylesheet">
<style>
  :root {
    --washi: #F7F4EF;
    --washi-dark: #EDE9E1;
    --sumi: #1A1A18;
    --sumi-mid: #3D3D39;
    --sumi-light: #7A7A74;
    --matcha: #6B7C5C;
    --matcha-light: #8FA07E;
    --matcha-pale: #D4DCC8;
    --kinari: #C4A882;
    --kinari-pale: #E8D9C5;
    --aka: #9B4F4F;
    --aka-pale: #E8D0D0;
    --mizu: #5B7B8A;
    --mizu-pale: #C8D8DF;
    --shadow: rgba(26,26,24,0.08);
    --border: rgba(26,26,24,0.1);
  }

- { margin:0; padding:0; box-sizing:border-box; }

body {
font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
background: var(â€“washi);
color: var(â€“sumi);
min-height: 100vh;
font-weight: 300;
overflow-x: hidden;
}

/* â”€â”€â”€ LAYOUT â”€â”€â”€ */
.app { display:flex; height:100vh; overflow:hidden; }

/* â”€â”€â”€ SIDEBAR â”€â”€â”€ */
.sidebar {
width: 72px;
background: var(â€“sumi);
display: flex;
flex-direction: column;
align-items: center;
padding: 24px 0;
gap: 8px;
flex-shrink: 0;
z-index: 10;
}

.sidebar-logo {
font-family: â€˜Cormorant Garamondâ€™, serif;
color: var(â€“kinari);
font-size: 20px;
font-weight: 300;
letter-spacing: 0.1em;
writing-mode: vertical-rl;
text-orientation: mixed;
margin-bottom: 24px;
padding-bottom: 24px;
border-bottom: 1px solid rgba(196,168,130,0.3);
}

.nav-item {
width: 48px;
height: 48px;
border-radius: 8px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.2s;
color: rgba(247,244,239,0.4);
font-size: 18px;
position: relative;
}

.nav-item:hover { background: rgba(247,244,239,0.08); color: var(â€“washi); }
.nav-item.active { background: var(â€“matcha); color: var(â€“washi); }

.nav-item .tooltip {
position: absolute;
left: 60px;
background: var(â€“sumi-mid);
color: var(â€“washi);
padding: 4px 10px;
border-radius: 4px;
font-size: 11px;
white-space: nowrap;
opacity: 0;
pointer-events: none;
transition: opacity 0.2s;
font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
}
.nav-item:hover .tooltip { opacity: 1; }

/* â”€â”€â”€ MAIN â”€â”€â”€ */
.main { flex:1; overflow:hidden; display:flex; flex-direction:column; }

/* â”€â”€â”€ HEADER â”€â”€â”€ */
.header {
background: var(â€“washi);
border-bottom: 1px solid var(â€“border);
padding: 16px 32px;
display: flex;
align-items: center;
justify-content: space-between;
flex-shrink: 0;
}

.header-title {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 22px;
font-weight: 300;
letter-spacing: 0.05em;
color: var(â€“sumi);
}

.month-nav {
display: flex;
align-items: center;
gap: 16px;
}

.month-btn {
width: 32px; height: 32px;
border: 1px solid var(â€“border);
background: none;
border-radius: 50%;
cursor: pointer;
color: var(â€“sumi-light);
font-size: 14px;
display: flex; align-items: center; justify-content: center;
transition: all 0.2s;
}
.month-btn:hover { border-color: var(â€“matcha); color: var(â€“matcha); }

.month-label {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 18px;
min-width: 160px;
text-align: center;
letter-spacing: 0.08em;
}

.header-actions { display:flex; gap:12px; }

.btn-primary {
background: var(â€“matcha);
color: var(â€“washi);
border: none;
padding: 9px 20px;
border-radius: 6px;
font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
font-size: 12px;
font-weight: 400;
letter-spacing: 0.08em;
cursor: pointer;
transition: all 0.2s;
}
.btn-primary:hover { background: var(â€“matcha-light); }

.btn-ghost {
background: none;
color: var(â€“sumi-light);
border: 1px solid var(â€“border);
padding: 9px 20px;
border-radius: 6px;
font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
font-size: 12px;
font-weight: 400;
letter-spacing: 0.08em;
cursor: pointer;
transition: all 0.2s;
}
.btn-ghost:hover { border-color: var(â€“sumi-light); color: var(â€“sumi); }

/* â”€â”€â”€ SUMMARY BAR â”€â”€â”€ */
.summary-bar {
background: var(â€“sumi);
padding: 16px 32px;
display: flex;
gap: 48px;
align-items: center;
}

.summary-item { display:flex; flex-direction:column; gap:4px; }
.summary-label {
font-size: 10px;
letter-spacing: 0.15em;
text-transform: uppercase;
color: rgba(247,244,239,0.45);
}
.summary-value {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 24px;
font-weight: 300;
letter-spacing: 0.02em;
color: var(â€“washi);
}
.summary-value.positive { color: var(â€“matcha-light); }
.summary-value.warning { color: var(â€“kinari); }
.summary-value.negative { color: #C47A7A; }

.summary-divider { width:1px; height:40px; background: rgba(247,244,239,0.1); }

.age-of-money {
margin-left: auto;
display: flex;
flex-direction: column;
align-items: flex-end;
gap: 4px;
}

.age-badge {
background: rgba(107,124,92,0.3);
border: 1px solid var(â€“matcha);
color: var(â€“matcha-light);
padding: 6px 14px;
border-radius: 20px;
font-size: 12px;
letter-spacing: 0.08em;
}

/* â”€â”€â”€ CONTENT â”€â”€â”€ */
.content { flex:1; overflow-y:auto; padding: 24px 32px; }

/* â”€â”€â”€ BUDGET GRID â”€â”€â”€ */
.budget-header {
display: grid;
grid-template-columns: 1fr 100px 110px 110px 80px;
gap: 8px;
padding: 0 16px 12px;
border-bottom: 1px solid var(â€“border);
margin-bottom: 8px;
}
.budget-header span {
font-size: 10px;
letter-spacing: 0.15em;
text-transform: uppercase;
color: var(â€“sumi-light);
font-weight: 400;
}
.budget-header span:not(:first-child) { text-align: right; }

/* â”€â”€â”€ CATEGORY GROUP â”€â”€â”€ */
.category-group { margin-bottom: 4px; }

.group-header {
display: grid;
grid-template-columns: 1fr 100px 110px 110px 80px;
gap: 8px;
padding: 10px 16px;
background: var(â€“washi-dark);
border-radius: 8px;
cursor: pointer;
align-items: center;
transition: background 0.15s;
user-select: none;
}
.group-header:hover { background: var(â€“kinari-pale); }

.group-name {
display: flex;
align-items: center;
gap: 8px;
font-size: 11px;
letter-spacing: 0.12em;
text-transform: uppercase;
font-weight: 400;
color: var(â€“sumi-mid);
}

.group-chevron { font-size: 10px; transition: transform 0.2s; color: var(â€“sumi-light); }
.group-header.collapsed .group-chevron { transform: rotate(-90deg); }

.group-total {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 14px;
text-align: right;
color: var(â€“sumi-mid);
}

/* â”€â”€â”€ CATEGORY ROW â”€â”€â”€ */
.categories { overflow: hidden; }
.categories.collapsed { display: none; }

.category-row {
display: grid;
grid-template-columns: 1fr 100px 110px 110px 80px;
gap: 8px;
padding: 10px 16px;
align-items: center;
border-radius: 6px;
cursor: pointer;
transition: background 0.15s;
margin: 1px 0;
}
.category-row:hover { background: rgba(107,124,92,0.07); }
.category-row.selected { background: var(â€“matcha-pale); }

.cat-name {
display: flex;
align-items: center;
gap: 10px;
font-size: 13px;
padding-left: 8px;
}
.cat-emoji { font-size: 14px; }

.cat-goal {
width: 6px; height: 6px;
border-radius: 50%;
background: var(â€“matcha);
flex-shrink: 0;
}
.cat-goal.warning { background: var(â€“kinari); }
.cat-goal.empty { background: var(â€“border); border: 1px solid var(â€“border); }

.cat-amount {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 16px;
text-align: right;
color: var(â€“sumi);
cursor: text;
padding: 2px 6px;
border-radius: 4px;
transition: background 0.15s;
position: relative;
}

.cat-amount-input {
position: absolute;
inset: 0;
background: none;
border: none;
border-radius: 4px;
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 16px;
text-align: right;
color: var(â€“sumi);
padding: 2px 6px;
outline: none;
display: none;
width: 100%;
}

.cat-amount:hover { background: var(â€“washi-dark); }
.cat-amount.editing { background: var(â€“matcha-pale); box-shadow: 0 0 0 1px var(â€“matcha); }

.cat-spent { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 16px; text-align:right; color: var(â€“sumi-light); }

.cat-available {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 16px;
text-align: right;
font-weight: 400;
}
.cat-available.positive { color: var(â€“matcha); }
.cat-available.overspent { color: var(â€“aka); }
.cat-available.zero { color: var(â€“sumi-light); }
.cat-available.funded { color: var(â€“mizu); }

.cat-progress {
height: 3px;
background: var(â€“border);
border-radius: 2px;
overflow: hidden;
margin-top: 2px;
}
.cat-progress-bar {
height: 100%;
background: var(â€“matcha);
border-radius: 2px;
transition: width 0.3s;
}
.cat-progress-bar.overspent { background: var(â€“aka); }

/* â”€â”€â”€ ADD CATEGORY â”€â”€â”€ */
.add-category-btn {
display: flex;
align-items: center;
gap: 8px;
padding: 8px 24px;
color: var(â€“sumi-light);
font-size: 12px;
letter-spacing: 0.08em;
cursor: pointer;
transition: color 0.15s;
background: none;
border: none;
width: 100%;
text-align: left;
font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
font-weight: 300;
}
.add-category-btn:hover { color: var(â€“matcha); }

/* â”€â”€â”€ PANELS â”€â”€â”€ */
.panel {
display: none;
padding: 0;
animation: fadeIn 0.2s ease;
}
.panel.active { display: block; }

@keyframes fadeIn { from { opacity:0; transform: translateY(4px); } to { opacity:1; transform:none; } }

/* â”€â”€â”€ TRANSACTIONS PANEL â”€â”€â”€ */
.transactions-grid { display: flex; flex-direction:column; gap:0; }

.tx-header {
display: grid;
grid-template-columns: 100px 1fr 160px 120px 120px;
gap: 8px;
padding: 0 16px 12px;
border-bottom: 1px solid var(â€“border);
margin-bottom: 4px;
}
.tx-header span {
font-size: 10px;
letter-spacing: 0.15em;
text-transform: uppercase;
color: var(â€“sumi-light);
}
.tx-header span:nth-child(n+3) { text-align: right; }

.tx-row {
display: grid;
grid-template-columns: 100px 1fr 160px 120px 120px;
gap: 8px;
padding: 12px 16px;
border-radius: 6px;
align-items: center;
cursor: pointer;
transition: background 0.15s;
border-bottom: 1px solid rgba(26,26,24,0.04);
}
.tx-row:hover { background: rgba(107,124,92,0.06); }
.tx-row.uncleared { opacity: 0.65; border-left: 2px solid var(â€“kinari); padding-left: 14px; }

.tx-date { font-size: 12px; color: var(â€“sumi-light); letter-spacing: 0.05em; }
.tx-payee { font-size: 13px; }
.tx-payee small { display:block; font-size:11px; color: var(â€“sumi-light); margin-top:2px; }

.tx-cat {
font-size: 11px;
color: var(â€“sumi-light);
background: var(â€“washi-dark);
padding: 3px 8px;
border-radius: 10px;
width: fit-content;
margin-left: auto;
}

.tx-amount {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 16px;
text-align: right;
}
.tx-amount.income { color: var(â€“matcha); }
.tx-amount.expense { color: var(â€“sumi); }

.tx-cleared {
text-align: right;
font-size: 11px;
color: var(â€“sumi-light);
}
.tx-cleared.ok { color: var(â€“matcha); }

/* â”€â”€â”€ GOALS PANEL â”€â”€â”€ */
.goals-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:16px; }

.goal-card {
background: white;
border: 1px solid var(â€“border);
border-radius: 12px;
padding: 24px;
cursor: pointer;
transition: all 0.2s;
position: relative;
overflow: hidden;
}
.goal-card::before {
content:â€™â€™;
position:absolute;
top:0; left:0; right:0;
height:3px;
background: var(â€“matcha);
transform: scaleX(var(â€“progress, 0));
transform-origin: left;
transition: transform 0.4s ease;
}
.goal-card.goal-debt::before { background: var(â€“aka); }
.goal-card.goal-save::before { background: var(â€“mizu); }
.goal-card:hover { box-shadow: 0 4px 20px var(â€“shadow); transform: translateY(-2px); }

.goal-icon { font-size: 28px; margin-bottom:12px; }
.goal-name { font-size: 13px; font-weight: 400; margin-bottom:4px; }
.goal-desc { font-size: 11px; color: var(â€“sumi-light); margin-bottom:16px; }

.goal-progress-track {
height: 4px; background: var(â€“washi-dark); border-radius: 2px; margin-bottom: 12px; overflow:hidden;
}
.goal-progress-fill {
height: 100%; border-radius: 2px; background: var(â€“matcha); transition: width 0.5s ease;
}
.goal-card.goal-debt .goal-progress-fill { background: var(â€“aka); }
.goal-card.goal-save .goal-progress-fill { background: var(â€“mizu); }

.goal-stats { display:flex; justify-content:space-between; align-items:flex-end; }
.goal-saved { font-family: â€˜Cormorant Garamondâ€™, serif; font-size:22px; font-weight:300; }
.goal-target { font-size:11px; color: var(â€“sumi-light); }
.goal-monthly { font-size:11px; color: var(â€“matcha); }

/* â”€â”€â”€ REPORTS PANEL â”€â”€â”€ */
.reports-grid { display:grid; grid-template-columns: 1fr 1fr; gap:24px; }

.report-card {
background: white;
border: 1px solid var(â€“border);
border-radius: 12px;
padding: 24px;
}
.report-card h3 {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 18px;
font-weight: 300;
margin-bottom: 20px;
color: var(â€“sumi);
letter-spacing: 0.03em;
}

.spending-bars { display:flex; flex-direction:column; gap:12px; }

.spend-row { display:flex; align-items:center; gap:12px; }
.spend-label { font-size:12px; width:120px; flex-shrink:0; }
.spend-track { flex:1; height:6px; background: var(â€“washi-dark); border-radius:3px; overflow:hidden; }
.spend-fill { height:100%; border-radius:3px; background: var(â€“matcha); }
.spend-amount { font-family: â€˜Cormorant Garamondâ€™, serif; font-size:14px; width:70px; text-align:right; }

.income-expense { display:flex; gap:20px; margin-bottom:20px; }
.ie-item { flex:1; background: var(â€“washi-dark); border-radius:8px; padding:16px; }
.ie-label { font-size:10px; letter-spacing:0.12em; text-transform:uppercase; color: var(â€“sumi-light); margin-bottom:6px; }
.ie-value { font-family: â€˜Cormorant Garamondâ€™, serif; font-size:26px; font-weight:300; }
.ie-value.i { color: var(â€“matcha); }
.ie-value.e { color: var(â€“aka); }

.mini-chart { height:80px; display:flex; align-items:flex-end; gap:4px; padding-top:8px; }
.mini-bar {
flex:1;
background: var(â€“matcha-pale);
border-radius:2px 2px 0 0;
position:relative;
transition: background 0.2s;
cursor: pointer;
}
.mini-bar:hover { background: var(â€“matcha); }
.mini-bar .bar-label { position:absolute; bottom:-18px; left:50%; transform:translateX(-50%); font-size:9px; color: var(â€“sumi-light); white-space:nowrap; }

/* â”€â”€â”€ MODAL â”€â”€â”€ */
.modal-overlay {
position:fixed; inset:0;
background: rgba(26,26,24,0.5);
backdrop-filter: blur(4px);
display:flex; align-items:center; justify-content:center;
z-index:100;
opacity:0; pointer-events:none;
transition: opacity 0.2s;
}
.modal-overlay.open { opacity:1; pointer-events:all; }

.modal {
background: var(â€“washi);
border-radius: 16px;
padding: 32px;
width: 480px;
max-width: 90vw;
transform: translateY(8px);
transition: transform 0.2s;
box-shadow: 0 20px 60px rgba(26,26,24,0.2);
}
.modal-overlay.open .modal { transform: none; }

.modal h2 {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 24px;
font-weight: 300;
margin-bottom: 24px;
letter-spacing: 0.03em;
}

.form-group { margin-bottom: 16px; }
.form-label { font-size:11px; letter-spacing:0.1em; text-transform:uppercase; color: var(â€“sumi-light); display:block; margin-bottom:6px; }
.form-input {
width:100%;
background: var(â€“washi-dark);
border: 1px solid var(â€“border);
border-radius: 8px;
padding: 10px 14px;
font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
font-size: 14px;
color: var(â€“sumi);
outline:none;
transition: border-color 0.2s;
}
.form-input:focus { border-color: var(â€“matcha); background: white; }

.form-row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }

.type-toggle { display:flex; gap:8px; }
.type-btn {
flex:1; padding:10px; border-radius:8px; border: 1px solid var(â€“border);
background: none; cursor:pointer; font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
font-size:12px; letter-spacing:0.08em; transition: all 0.2s; color: var(â€“sumi-light);
}
.type-btn.active.expense { background: var(â€“aka-pale); border-color: var(â€“aka); color: var(â€“aka); }
.type-btn.active.income { background: var(â€“matcha-pale); border-color: var(â€“matcha); color: var(â€“matcha); }

.modal-actions { display:flex; gap:12px; margin-top:24px; }
.modal-actions .btn-primary { flex:1; padding:12px; font-size:13px; }
.modal-cancel {
padding:12px 20px; border-radius:6px; border: 1px solid var(â€“border);
background: none; cursor:pointer; font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
font-size:13px; color: var(â€“sumi-light); transition: all 0.2s;
}
.modal-cancel:hover { border-color: var(â€“sumi-light); color: var(â€“sumi); }

/* â”€â”€â”€ TOFU TOAST â”€â”€â”€ */
.toast {
position:fixed; bottom:24px; left:50%; transform:translateX(-50%) translateY(16px);
background: var(â€“sumi); color: var(â€“washi);
padding: 10px 20px; border-radius: 20px;
font-size: 12px; letter-spacing: 0.08em;
opacity:0; transition: all 0.3s;
z-index:200;
pointer-events:none;
}
.toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

/* â”€â”€â”€ SCROLLBAR â”€â”€â”€ */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(â€“border); border-radius: 2px; }

/* â”€â”€â”€ EMPTY STATE â”€â”€â”€ */
.empty-state {
text-align:center; padding: 60px 20px;
color: var(â€“sumi-light);
}
.empty-state .kanji { font-family: â€˜Cormorant Garamondâ€™, serif; font-size:48px; font-weight:300; margin-bottom:12px; opacity:0.3; }
.empty-state p { font-size:13px; }

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€ */
@media(max-width:768px) {
.sidebar { width:56px; }
.content { padding: 16px; }
.summary-bar { padding: 12px 16px; gap:24px; overflow-x:auto; }
.reports-grid { grid-template-columns:1fr; }
.budget-header, .category-row, .group-header { grid-template-columns: 1fr 80px 90px; }
.budget-header span:nth-child(n+4), .group-total:nth-child(n+4),
.cat-spent, .cat-progress { display:none; }
}

.section-title {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 13px;
letter-spacing: 0.15em;
text-transform: uppercase;
color: var(â€“sumi-light);
margin-bottom: 16px;
margin-top: 8px;
padding-bottom: 8px;
border-bottom: 1px solid var(â€“border);
display:flex; justify-content:space-between; align-items:center;
}
</style>

</head>
<body>

<div class="app">
  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="sidebar-logo">é–“</div>
    <div class="nav-item active" onclick="showPanel('budget')" title="">
      âŠ <span class="tooltip">Presupuesto</span>
    </div>
    <div class="nav-item" onclick="showPanel('transactions')" title="">
      â‰¡ <span class="tooltip">Transacciones</span>
    </div>
    <div class="nav-item" onclick="showPanel('goals')" title="">
      â— <span class="tooltip">Metas</span>
    </div>
    <div class="nav-item" onclick="showPanel('reports')" title="">
      â—» <span class="tooltip">Informes</span>
    </div>
  </nav>

  <div class="main">
    <!-- HEADER -->
    <header class="header">
      <h1 class="header-title" id="panelTitle">Presupuesto</h1>
      <div class="month-nav">
        <button class="month-btn" onclick="changeMonth(-1)">â€¹</button>
        <span class="month-label" id="monthLabel"></span>
        <button class="month-btn" onclick="changeMonth(1)">â€º</button>
      </div>
      <div class="header-actions">
        <button class="btn-ghost" onclick="openModal('category')">+ CategorÃ­a</button>
        <button class="btn-primary" onclick="openModal('transaction')">+ TransacciÃ³n</button>
      </div>
    </header>

```
<!-- SUMMARY BAR -->
<div class="summary-bar">
  <div class="summary-item">
    <span class="summary-label">Para Asignar</span>
    <span class="summary-value positive" id="toAssign">â‚¬0,00</span>
  </div>
  <div class="summary-divider"></div>
  <div class="summary-item">
    <span class="summary-label">Asignado</span>
    <span class="summary-value" id="totalAssigned">â‚¬0,00</span>
  </div>
  <div class="summary-divider"></div>
  <div class="summary-item">
    <span class="summary-label">Gastado</span>
    <span class="summary-value warning" id="totalSpent">â‚¬0,00</span>
  </div>
  <div class="summary-divider"></div>
  <div class="summary-item">
    <span class="summary-label">Disponible</span>
    <span class="summary-value positive" id="totalAvailable">â‚¬0,00</span>
  </div>
  <div class="age-of-money">
    <span class="summary-label">Edad del dinero</span>
    <span class="age-badge" id="ageOfMoney">â³ 0 dÃ­as</span>
  </div>
</div>

<!-- CONTENT -->
<div class="content">

  <!-- BUDGET PANEL -->
  <div class="panel active" id="panel-budget">
    <div class="budget-header">
      <span>CategorÃ­a</span>
      <span>Asignado</span>
      <span>Gastado</span>
      <span>Disponible</span>
      <span></span>
    </div>
    <div id="budgetGroups"></div>
  </div>

  <!-- TRANSACTIONS PANEL -->
  <div class="panel" id="panel-transactions">
    <div class="tx-header">
      <span>Fecha</span>
      <span>DescripciÃ³n</span>
      <span>CategorÃ­a</span>
      <span>Importe</span>
      <span>Estado</span>
    </div>
    <div id="txList" class="transactions-grid"></div>
  </div>

  <!-- GOALS PANEL -->
  <div class="panel" id="panel-goals">
    <div class="section-title">
      Metas financieras
      <button class="btn-primary" style="font-size:11px;padding:6px 14px;" onclick="openModal('goal')">+ Nueva meta</button>
    </div>
    <div class="goals-grid" id="goalsList"></div>
  </div>

  <!-- REPORTS PANEL -->
  <div class="panel" id="panel-reports">
    <div class="reports-grid" id="reportsContent"></div>
  </div>

</div>
```

  </div>
</div>

<!-- TRANSACTION MODAL -->

<div class="modal-overlay" id="modal-transaction">
  <div class="modal">
    <h2>Nueva transacciÃ³n</h2>
    <div class="form-group">
      <label class="form-label">Tipo</label>
      <div class="type-toggle">
        <button class="type-btn active expense" onclick="setType('expense')">Gasto</button>
        <button class="type-btn income" onclick="setType('income')">Ingreso</button>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Fecha</label>
        <input type="date" class="form-input" id="tx-date">
      </div>
      <div class="form-group">
        <label class="form-label">Importe (â‚¬)</label>
        <input type="number" class="form-input" id="tx-amount" placeholder="0,00" step="0.01" min="0">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">DescripciÃ³n / Pagador</label>
      <input type="text" class="form-input" id="tx-payee" placeholder="ej. Mercadona">
    </div>
    <div class="form-group" id="tx-cat-group">
      <label class="form-label">CategorÃ­a</label>
      <select class="form-input" id="tx-category"></select>
    </div>
    <div class="form-group">
      <label class="form-label">Nota (opcional)</label>
      <input type="text" class="form-input" id="tx-note" placeholder="">
    </div>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="closeModal('transaction')">Cancelar</button>
      <button class="btn-primary" onclick="saveTransaction()">Guardar transacciÃ³n</button>
    </div>
  </div>
</div>

<!-- CATEGORY MODAL -->

<div class="modal-overlay" id="modal-category">
  <div class="modal">
    <h2>Nueva categorÃ­a</h2>
    <div class="form-group">
      <label class="form-label">Grupo</label>
      <select class="form-input" id="cat-group-sel">
        <option value="">â€” Nuevo grupo â€”</option>
      </select>
    </div>
    <div class="form-group" id="new-group-name-wrap">
      <label class="form-label">Nombre del grupo</label>
      <input type="text" class="form-input" id="new-group-name" placeholder="ej. Hogar">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Emoji</label>
        <input type="text" class="form-input" id="cat-emoji" placeholder="ğŸ " maxlength="2">
      </div>
      <div class="form-group">
        <label class="form-label">Nombre</label>
        <input type="text" class="form-input" id="cat-name-input" placeholder="ej. Alquiler">
      </div>
    </div>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="closeModal('category')">Cancelar</button>
      <button class="btn-primary" onclick="saveCategory()">Crear categorÃ­a</button>
    </div>
  </div>
</div>

<!-- GOAL MODAL -->

<div class="modal-overlay" id="modal-goal">
  <div class="modal">
    <h2>Nueva meta</h2>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Emoji</label>
        <input type="text" class="form-input" id="goal-emoji" placeholder="ğŸ¯" maxlength="2">
      </div>
      <div class="form-group">
        <label class="form-label">Tipo</label>
        <select class="form-input" id="goal-type">
          <option value="save">Ahorro</option>
          <option value="debt">Deuda</option>
          <option value="spend">Gasto futuro</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Nombre</label>
      <input type="text" class="form-input" id="goal-name" placeholder="ej. Fondo de emergencia">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Objetivo (â‚¬)</label>
        <input type="number" class="form-input" id="goal-target" placeholder="5000">
      </div>
      <div class="form-group">
        <label class="form-label">Ahorrado hasta ahora (â‚¬)</label>
        <input type="number" class="form-input" id="goal-saved" placeholder="0">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Fecha objetivo</label>
      <input type="month" class="form-input" id="goal-date">
    </div>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="closeModal('goal')">Cancelar</button>
      <button class="btn-primary" onclick="saveGoal()">Crear meta</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state = {
  currentMonth: new Date(),
  toAssign: 3500,
  groups: [
    {
      id: 'g1', name: 'Gastos esenciales', collapsed: false,
      categories: [
        { id: 'c1', name: 'Alquiler', emoji: 'ğŸ ', assigned: 900, spent: 900 },
        { id: 'c2', name: 'Suministros', emoji: 'ğŸ’¡', assigned: 120, spent: 87.50 },
        { id: 'c3', name: 'Supermercado', emoji: 'ğŸ›’', assigned: 350, spent: 267.30 },
        { id: 'c4', name: 'Transporte', emoji: 'ğŸš‡', assigned: 80, spent: 54 },
        { id: 'c5', name: 'TelÃ©fono / Internet', emoji: 'ğŸ“¡', assigned: 45, spent: 45 },
      ]
    },
    {
      id: 'g2', name: 'Estilo de vida', collapsed: false,
      categories: [
        { id: 'c6', name: 'Restaurantes', emoji: 'ğŸœ', assigned: 150, spent: 198 },
        { id: 'c7', name: 'Ocio', emoji: 'ğŸ­', assigned: 100, spent: 43 },
        { id: 'c8', name: 'Ropa', emoji: 'ğŸ‘˜', assigned: 80, spent: 0 },
        { id: 'c9', name: 'Salud', emoji: 'âš•ï¸', assigned: 60, spent: 25 },
      ]
    },
    {
      id: 'g3', name: 'Verdaderos gastos', collapsed: false,
      categories: [
        { id: 'c10', name: 'Vacaciones', emoji: 'âœˆï¸', assigned: 150, spent: 0 },
        { id: 'c11', name: 'Mantenimiento coche', emoji: 'ğŸ”§', assigned: 50, spent: 0 },
        { id: 'c12', name: 'Regalos / Navidad', emoji: 'ğŸ', assigned: 40, spent: 0 },
        { id: 'c13', name: 'ElectrÃ³nica', emoji: 'ğŸ’»', assigned: 30, spent: 0 },
      ]
    },
    {
      id: 'g4', name: 'Ahorro y deuda', collapsed: false,
      categories: [
        { id: 'c14', name: 'Fondo de emergencia', emoji: 'ğŸ¦', assigned: 200, spent: 0 },
        { id: 'c15', name: 'InversiÃ³n', emoji: 'ğŸ“ˆ', assigned: 150, spent: 0 },
        { id: 'c16', name: 'Deuda tarjeta', emoji: 'ğŸ’³', assigned: 100, spent: 100 },
      ]
    }
  ],
  transactions: [
    { id: 't1', date: '2025-01-15', payee: 'Mercadona', category: 'c3', amount: 87.30, type: 'expense', cleared: true, note: '' },
    { id: 't2', date: '2025-01-14', payee: 'NÃ³mina enero', category: null, amount: 3500, type: 'income', cleared: true, note: '' },
    { id: 't3', date: '2025-01-13', payee: 'Ramen Ichiban', category: 'c6', amount: 32, type: 'expense', cleared: true, note: 'Cena con amigos' },
    { id: 't4', date: '2025-01-12', payee: 'Zara Home', category: 'c8', amount: 0, type: 'expense', cleared: false, note: '' },
    { id: 't5', date: '2025-01-10', payee: 'Farmacia', category: 'c9', amount: 25, type: 'expense', cleared: true, note: '' },
    { id: 't6', date: '2025-01-08', payee: 'Metro mensual', category: 'c4', amount: 54, type: 'expense', cleared: true, note: '' },
    { id: 't7', date: '2025-01-06', payee: 'Netflix + Spotify', category: 'c7', amount: 23, type: 'expense', cleared: true, note: '' },
    { id: 't8', date: '2025-01-05', payee: 'Iberdrola', category: 'c2', amount: 87.50, type: 'expense', cleared: true, note: '' },
    { id: 't9', date: '2025-01-03', payee: 'Alquiler', category: 'c1', amount: 900, type: 'expense', cleared: true, note: '' },
    { id: 't10', date: '2025-01-02', payee: 'Restaurante Momo', category: 'c6', amount: 85, type: 'expense', cleared: false, note: '' },
  ],
  goals: [
    { id: 'goal1', name: 'Fondo de emergencia', emoji: 'ğŸ¦', type: 'save', target: 6000, saved: 2400, date: '2025-12' },
    { id: 'goal2', name: 'Viaje a JapÃ³n', emoji: 'ğŸ—¾', type: 'save', target: 3000, saved: 750, date: '2026-03' },
    { id: 'goal3', name: 'Deuda tarjeta', emoji: 'ğŸ’³', type: 'debt', target: 1800, saved: 1200, date: '2025-06' },
    { id: 'goal4', name: 'Nuevo portÃ¡til', emoji: 'ğŸ’»', type: 'spend', target: 1500, saved: 300, date: '2025-09' },
  ],
  txType: 'expense',
};

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const fmt = n => 'â‚¬' + Math.abs(n).toFixed(2).replace('.', ',');
const fmtN = n => (n < 0 ? '-' : '') + fmt(n);

function getCatById(id) {
  for (const g of state.groups) {
    const c = g.categories.find(c => c.id === id);
    if (c) return c;
  }
  return null;
}

function calcSummary() {
  let assigned = 0, spent = 0;
  for (const g of state.groups) {
    for (const c of g.categories) {
      assigned += c.assigned;
      spent += c.spent;
    }
  }
  const available = assigned - spent;
  const toAssign = state.toAssign - assigned;

  document.getElementById('toAssign').textContent = fmt(toAssign);
  document.getElementById('toAssign').className = 'summary-value ' + (toAssign < 0 ? 'negative' : toAssign === 0 ? 'warning' : 'positive');
  document.getElementById('totalAssigned').textContent = fmt(assigned);
  document.getElementById('totalSpent').textContent = fmt(spent);
  document.getElementById('totalAvailable').textContent = fmt(available);

  // Age of money: heuristic
  const incomes = state.transactions.filter(t => t.type === 'income');
  const avgIncome = incomes.reduce((s, t) => s + t.amount, 0) / (incomes.length || 1);
  const monthlySpend = spent;
  const age = avgIncome > 0 ? Math.round((avgIncome / (monthlySpend || 1)) * 30) : 0;
  document.getElementById('ageOfMoney').textContent = `â³ ${Math.min(age, 90)} dÃ­as`;
}

// â”€â”€â”€ MONTH NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const months = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];

function updateMonthLabel() {
  const m = state.currentMonth;
  document.getElementById('monthLabel').textContent = months[m.getMonth()] + ' ' + m.getFullYear();
}

function changeMonth(dir) {
  state.currentMonth = new Date(state.currentMonth.getFullYear(), state.currentMonth.getMonth() + dir, 1);
  updateMonthLabel();
}

// â”€â”€â”€ PANEL NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const panelTitles = { budget: 'Presupuesto', transactions: 'Transacciones', goals: 'Metas', reports: 'Informes' };

function showPanel(name) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  document.querySelectorAll('.nav-item')[['budget','transactions','goals','reports'].indexOf(name)].classList.add('active');
  document.getElementById('panelTitle').textContent = panelTitles[name];
  if (name === 'reports') renderReports();
  if (name === 'goals') renderGoals();
  if (name === 'transactions') renderTransactions();
}

// â”€â”€â”€ BUDGET RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderBudget() {
  const container = document.getElementById('budgetGroups');
  container.innerHTML = '';

  for (const group of state.groups) {
    const groupEl = document.createElement('div');
    groupEl.className = 'category-group';

    let gAssigned = group.categories.reduce((s,c) => s+c.assigned, 0);
    let gSpent = group.categories.reduce((s,c) => s+c.spent, 0);
    let gAvail = gAssigned - gSpent;

    const header = document.createElement('div');
    header.className = 'group-header' + (group.collapsed ? ' collapsed' : '');
    header.innerHTML = `
      <span class="group-name"><span class="group-chevron">â–¾</span>${group.name}</span>
      <span class="group-total">${fmt(gAssigned)}</span>
      <span class="group-total">${fmt(gSpent)}</span>
      <span class="group-total" style="color:${gAvail<0?'var(--aka)':'var(--sumi-mid)'}">${fmtN(gAvail)}</span>
      <span></span>
    `;
    header.onclick = () => {
      group.collapsed = !group.collapsed;
      header.classList.toggle('collapsed');
      catsEl.classList.toggle('collapsed');
    };
    groupEl.appendChild(header);

    const catsEl = document.createElement('div');
    catsEl.className = 'categories' + (group.collapsed ? ' collapsed' : '');

    for (const cat of group.categories) {
      const avail = cat.assigned - cat.spent;
      const pct = cat.assigned > 0 ? Math.min(cat.spent / cat.assigned * 100, 100) : 0;
      const overspent = avail < 0;
      const fullFunded = avail === 0 && cat.assigned > 0;

      const row = document.createElement('div');
      row.className = 'category-row';
      row.innerHTML = `
        <div class="cat-name">
          <span class="cat-emoji">${cat.emoji}</span>
          <span class="cat-goal ${overspent?'warning':cat.assigned===0?'empty':''}"></span>
          ${cat.name}
        </div>
        <div class="cat-amount" id="amt-${cat.id}" onclick="startEditAmount('${cat.id}', event)">
          ${fmt(cat.assigned)}
          <input class="cat-amount-input" id="inp-${cat.id}" type="number" min="0" step="0.01"
            onblur="endEditAmount('${cat.id}')"
            onkeydown="if(event.key==='Enter')endEditAmount('${cat.id}');if(event.key==='Escape')cancelEdit('${cat.id}')">
        </div>
        <div class="cat-spent">${fmt(cat.spent)}</div>
        <div class="cat-available ${overspent?'overspent':avail===0&&cat.assigned>0?'zero':avail>0?'positive':''}">${fmtN(avail)}</div>
        <div>
          <div class="cat-progress"><div class="cat-progress-bar ${overspent?'overspent':''}" style="width:${pct}%"></div></div>
        </div>
      `;
      catsEl.appendChild(row);
    }

    const addBtn = document.createElement('button');
    addBtn.className = 'add-category-btn';
    addBtn.innerHTML = '+ aÃ±adir categorÃ­a';
    addBtn.onclick = () => openModal('category');
    catsEl.appendChild(addBtn);

    groupEl.appendChild(catsEl);
    container.appendChild(groupEl);
  }
  calcSummary();
}

function startEditAmount(catId, e) {
  e.stopPropagation();
  const amtEl = document.getElementById('amt-' + catId);
  const inp = document.getElementById('inp-' + catId);
  amtEl.classList.add('editing');
  inp.style.display = 'block';
  const cat = getCatById(catId);
  inp.value = cat.assigned;
  inp.focus();
  inp.select();
}

function endEditAmount(catId) {
  const amtEl = document.getElementById('amt-' + catId);
  const inp = document.getElementById('inp-' + catId);
  const cat = getCatById(catId);
  const val = parseFloat(inp.value) || 0;
  cat.assigned = val;
  amtEl.classList.remove('editing');
  inp.style.display = 'none';
  renderBudget();
  showToast('AsignaciÃ³n actualizada');
}

function cancelEdit(catId) {
  const amtEl = document.getElementById('amt-' + catId);
  const inp = document.getElementById('inp-' + catId);
  amtEl.classList.remove('editing');
  inp.style.display = 'none';
}

// â”€â”€â”€ TRANSACTIONS RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTransactions() {
  const list = document.getElementById('txList');
  const sorted = [...state.transactions].sort((a,b) => b.date.localeCompare(a.date));

  if (sorted.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="kanji">ç„¡</div><p>Sin transacciones todavÃ­a</p></div>`;
    return;
  }

  list.innerHTML = sorted.map(tx => {
    const cat = tx.category ? getCatById(tx.category) : null;
    const d = new Date(tx.date + 'T12:00:00');
    const dateStr = d.toLocaleDateString('es-ES', { day:'2-digit', month:'short' });
    return `
      <div class="tx-row ${tx.cleared?'':'uncleared'}">
        <div class="tx-date">${dateStr}</div>
        <div class="tx-payee">${tx.payee}${tx.note?`<small>${tx.note}</small>`:''}</div>
        <div class="tx-cat">${cat ? cat.emoji + ' ' + cat.name : (tx.type==='income'?'ğŸ’° Ingreso':'â€”')}</div>
        <div class="tx-amount ${tx.type}">${tx.type==='income'?'+':'âˆ’'}${fmt(tx.amount)}</div>
        <div class="tx-cleared ${tx.cleared?'ok':''}">${tx.cleared?'âœ“ liquidado':'pendiente'}</div>
      </div>
    `;
  }).join('');
}

// â”€â”€â”€ GOALS RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderGoals() {
  const list = document.getElementById('goalsList');
  if (state.goals.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="kanji">å¤¢</div><p>AÃ±ade tu primera meta financiera</p></div>`;
    return;
  }
  list.innerHTML = state.goals.map(g => {
    const pct = Math.min(g.saved / g.target * 100, 100);
    const remaining = g.target - g.saved;
    const targetDate = new Date(g.date + '-01');
    const now = new Date();
    const monthsLeft = Math.max(1, (targetDate.getFullYear() - now.getFullYear()) * 12 + targetDate.getMonth() - now.getMonth());
    const monthly = remaining > 0 ? (remaining / monthsLeft).toFixed(0) : 0;
    return `
      <div class="goal-card goal-${g.type}" style="--progress:${pct/100}">
        <div class="goal-icon">${g.emoji}</div>
        <div class="goal-name">${g.name}</div>
        <div class="goal-desc">${g.type==='save'?'Ahorro':'g.type'==='debt'?'Deuda':'Gasto futuro'} Â· objetivo ${g.date}</div>
        <div class="goal-progress-track">
          <div class="goal-progress-fill" style="width:${pct}%"></div>
        </div>
        <div class="goal-stats">
          <div>
            <div class="goal-saved">${fmt(g.saved)}</div>
            <div class="goal-target">de ${fmt(g.target)}</div>
          </div>
          <div class="goal-monthly">â‚¬${monthly}/mes</div>
        </div>
      </div>
    `;
  }).join('');
}

// â”€â”€â”€ REPORTS RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderReports() {
  const container = document.getElementById('reportsContent');

  // Spending by category
  let cats = [];
  for (const g of state.groups) {
    for (const c of g.categories) {
      if (c.spent > 0) cats.push(c);
    }
  }
  cats.sort((a,b) => b.spent - a.spent);
  const maxSpent = cats[0]?.spent || 1;

  const totalIncome = state.transactions.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0);
  const totalSpent = state.transactions.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0);

  // Monthly bar data (last 6 months placeholder)
  const monthBars = [1800,2100,2450,1950,2800,totalSpent].map((v,i) => {
    const mn = new Date(state.currentMonth.getFullYear(), state.currentMonth.getMonth()-5+i, 1);
    return { v, label: months[mn.getMonth()].slice(0,3) };
  });
  const maxBar = Math.max(...monthBars.map(b=>b.v));

  container.innerHTML = `
    <div class="report-card">
      <h3>Gasto por categorÃ­a</h3>
      <div class="spending-bars">
        ${cats.slice(0,8).map(c => `
          <div class="spend-row">
            <div class="spend-label">${c.emoji} ${c.name}</div>
            <div class="spend-track"><div class="spend-fill" style="width:${c.spent/maxSpent*100}%"></div></div>
            <div class="spend-amount">${fmt(c.spent)}</div>
          </div>
        `).join('')}
      </div>
    </div>
    <div class="report-card">
      <h3>Ingresos vs Gastos</h3>
      <div class="income-expense">
        <div class="ie-item">
          <div class="ie-label">Ingresos</div>
          <div class="ie-value i">${fmt(totalIncome)}</div>
        </div>
        <div class="ie-item">
          <div class="ie-label">Gastos</div>
          <div class="ie-value e">${fmt(totalSpent)}</div>
        </div>
      </div>
      <div style="font-size:11px;color:var(--sumi-light);margin-bottom:8px;letter-spacing:0.1em;text-transform:uppercase;">Ãšltimos 6 meses</div>
      <div class="mini-chart">
        ${monthBars.map(b => `
          <div class="mini-bar" style="height:${b.v/maxBar*100}%" title="${fmt(b.v)}">
            <span class="bar-label">${b.label}</span>
          </div>
        `).join('')}
      </div>
    </div>
    <div class="report-card">
      <h3>DistribuciÃ³n del presupuesto</h3>
      <div class="spending-bars">
        ${state.groups.map(g => {
          const total = g.categories.reduce((s,c)=>s+c.assigned,0);
          const allAssigned = state.groups.reduce((s,gr)=>s+gr.categories.reduce((ss,c)=>ss+c.assigned,0),0);
          const pct = allAssigned > 0 ? total/allAssigned*100 : 0;
          return `
            <div class="spend-row">
              <div class="spend-label" style="font-size:11px;">${g.name}</div>
              <div class="spend-track"><div class="spend-fill" style="width:${pct}%;background:var(--mizu)"></div></div>
              <div class="spend-amount">${pct.toFixed(0)}%</div>
            </div>
          `;
        }).join('')}
      </div>
    </div>
    <div class="report-card">
      <h3>Edad del dinero</h3>
      <div style="text-align:center;padding:20px 0;">
        <div style="font-family:'Cormorant Garamond',serif;font-size:72px;font-weight:300;color:var(--matcha);line-height:1">
          ${Math.min(Math.round(totalIncome/(totalSpent||1)*30), 90)}
        </div>
        <div style="font-size:12px;letter-spacing:0.1em;text-transform:uppercase;color:var(--sumi-light);margin-top:8px">dÃ­as de media</div>
        <div style="font-size:12px;color:var(--sumi-light);margin-top:16px;max-width:200px;margin-inline:auto;line-height:1.6">
          Cuanto mayor sea este nÃºmero, mÃ¡s estable tu economÃ­a. Objetivo: 30+ dÃ­as.
        </div>
      </div>
    </div>
  `;
}

// â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(name) {
  if (name === 'transaction') {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('tx-date').value = today;
    document.getElementById('tx-amount').value = '';
    document.getElementById('tx-payee').value = '';
    document.getElementById('tx-note').value = '';
    const sel = document.getElementById('tx-category');
    sel.innerHTML = '<option value="">â€” sin categorÃ­a â€”</option>';
    for (const g of state.groups) {
      const optg = document.createElement('optgroup');
      optg.label = g.name;
      for (const c of g.categories) {
        const opt = document.createElement('option');
        opt.value = c.id;
        opt.textContent = c.emoji + ' ' + c.name;
        optg.appendChild(opt);
      }
      sel.appendChild(optg);
    }
  }
  if (name === 'category') {
    const sel = document.getElementById('cat-group-sel');
    sel.innerHTML = '<option value="">â€” Nuevo grupo â€”</option>';
    for (const g of state.groups) {
      const opt = document.createElement('option');
      opt.value = g.id; opt.textContent = g.name;
      sel.appendChild(opt);
    }
    sel.onchange = () => {
      document.getElementById('new-group-name-wrap').style.display = sel.value ? 'none' : 'block';
    };
    document.getElementById('new-group-name-wrap').style.display = 'block';
  }
  document.getElementById('modal-' + name).classList.add('open');
}

function closeModal(name) {
  document.getElementById('modal-' + name).classList.remove('open');
}

// Close on overlay click
document.querySelectorAll('.modal-overlay').forEach(o => {
  o.addEventListener('click', e => { if (e.target === o) o.classList.remove('open'); });
});

function setType(type) {
  state.txType = type;
  document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
  document.querySelector('.type-btn.' + type).classList.add('active');
  document.getElementById('tx-cat-group').style.display = type === 'income' ? 'none' : 'block';
}

function saveTransaction() {
  const amount = parseFloat(document.getElementById('tx-amount').value) || 0;
  const payee = document.getElementById('tx-payee').value.trim();
  if (!payee || amount <= 0) { showToast('Completa todos los campos'); return; }

  const tx = {
    id: 't' + Date.now(),
    date: document.getElementById('tx-date').value,
    payee,
    category: state.txType === 'income' ? null : (document.getElementById('tx-category').value || null),
    amount,
    type: state.txType,
    cleared: false,
    note: document.getElementById('tx-note').value,
  };

  // Update spent
  if (tx.type === 'expense' && tx.category) {
    const cat = getCatById(tx.category);
    if (cat) cat.spent += amount;
  }
  if (tx.type === 'income') state.toAssign += amount;

  state.transactions.unshift(tx);
  closeModal('transaction');
  renderBudget();
  renderTransactions();
  showToast('TransacciÃ³n guardada âœ“');
}

function saveCategory() {
  const groupSel = document.getElementById('cat-group-sel').value;
  const emoji = document.getElementById('cat-emoji').value || 'ğŸ“Œ';
  const name = document.getElementById('cat-name-input').value.trim();
  if (!name) { showToast('Escribe un nombre'); return; }

  const newCat = { id: 'c' + Date.now(), name, emoji, assigned: 0, spent: 0 };

  if (groupSel) {
    const g = state.groups.find(g => g.id === groupSel);
    if (g) g.categories.push(newCat);
  } else {
    const groupName = document.getElementById('new-group-name').value.trim() || 'Nuevo grupo';
    state.groups.push({ id: 'g' + Date.now(), name: groupName, collapsed: false, categories: [newCat] });
  }

  closeModal('category');
  renderBudget();
  showToast('CategorÃ­a creada âœ“');
}

function saveGoal() {
  const name = document.getElementById('goal-name').value.trim();
  const target = parseFloat(document.getElementById('goal-target').value) || 0;
  const saved = parseFloat(document.getElementById('goal-saved').value) || 0;
  if (!name || target <= 0) { showToast('Completa el nombre y objetivo'); return; }

  state.goals.push({
    id: 'goal' + Date.now(),
    name,
    emoji: document.getElementById('goal-emoji').value || 'ğŸ¯',
    type: document.getElementById('goal-type').value,
    target, saved,
    date: document.getElementById('goal-date').value || '2026-01',
  });

  closeModal('goal');
  renderGoals();
  showToast('Meta creada âœ“');
}

// â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
updateMonthLabel();
renderBudget();
</script>

</body>
</html>

<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>é–“ â€” Ma Budget</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Zen+Kaku+Gothic+New:wght@300;400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #F2EFE8;
    --bg2: #E8E4DB;
    --bg3: #DDD8CC;
    --card: #FDFBF7;
    --sumi: #1C1C1A;
    --sumi-mid: #3A3A36;
    --sumi-light: #6B6B65;
    --sumi-xlight: #9A9A93;
    --matcha: #4A6741;
    --matcha-mid: #5E8054;
    --matcha-light: #7A9E6D;
    --matcha-pale: #C8D8BF;
    --kinari: #B8935A;
    --kinari-pale: #F0E4D0;
    --aka: #8B3A3A;
    --aka-mid: #B04A4A;
    --aka-pale: #F0D8D8;
    --mizu: #3A6878;
    --mizu-pale: #C0D4DC;
    --border: rgba(28,28,26,0.12);
    --border-strong: rgba(28,28,26,0.22);
    --shadow-sm: 0 1px 4px rgba(28,28,26,0.08);
  }

- { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; overflow: hidden; }

body {
font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
background: var(â€“bg);
color: var(â€“sumi);
font-weight: 400;
font-size: 15px;
}

.app {
display: flex;
flex-direction: column;
height: 100%;
max-width: 480px;
margin: 0 auto;
background: var(â€“bg);
}

/* â”€â”€ TOP HEADER â”€â”€ */
.top-header {
background: var(â€“sumi);
padding: 48px 20px 0;
flex-shrink: 0;
}

.top-bar {
display: flex;
align-items: center;
justify-content: space-between;
margin-bottom: 18px;
}

.logo {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 22px;
font-weight: 300;
color: var(â€“kinari);
letter-spacing: 0.12em;
}

.month-nav {
display: flex;
align-items: center;
background: rgba(255,255,255,0.1);
border-radius: 20px;
overflow: hidden;
}

.month-btn {
background: none; border: none;
color: rgba(255,255,255,0.7);
width: 34px; height: 34px;
font-size: 18px; cursor: pointer;
display: flex; align-items: center; justify-content: center;
}
.month-btn:active { color: white; }

.month-label {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 14px; color: white;
letter-spacing: 0.06em;
padding: 0 2px;
min-width: 110px; text-align: center;
}

.header-btn {
width: 34px; height: 34px;
background: rgba(255,255,255,0.1);
border: none; border-radius: 50%;
color: rgba(255,255,255,0.8);
font-size: 15px; cursor: pointer;
display: flex; align-items: center; justify-content: center;
}
.header-btn:active { background: rgba(255,255,255,0.2); }

.summary-pills {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 8px;
padding-bottom: 18px;
}

.pill {
background: rgba(255,255,255,0.08);
border-radius: 10px;
padding: 11px 8px;
text-align: center;
}

.pill-label {
font-size: 9px; letter-spacing: 0.13em;
text-transform: uppercase;
color: rgba(255,255,255,0.48);
margin-bottom: 4px; display: block;
}

.pill-value {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 19px; font-weight: 400;
color: white; letter-spacing: -0.01em;
}
.pill-value.green { color: #9DC98A; }
.pill-value.amber { color: #E0C080; }
.pill-value.red   { color: #D88080; }

/* â”€â”€ ASSIGN BANNER â”€â”€ */
.assign-banner {
background: var(â€“matcha);
padding: 13px 20px;
display: flex;
align-items: center;
justify-content: space-between;
flex-shrink: 0;
}

.assign-left { display: flex; flex-direction: column; }
.assign-label { font-size: 9px; letter-spacing: 0.14em; text-transform: uppercase; color: rgba(255,255,255,0.6); margin-bottom: 1px; }
.assign-value { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 24px; color: white; font-weight: 300; }
.assign-value.surplus { color: #C8E8B8; }
.assign-value.deficit { color: #F0B0B0; }

.assign-age {
background: rgba(0,0,0,0.18);
border-radius: 18px; padding: 6px 14px;
text-align: center;
}
.assign-age-num { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 22px; color: white; line-height: 1; }
.assign-age-label { font-size: 8px; letter-spacing: 0.1em; text-transform: uppercase; color: rgba(255,255,255,0.5); }

/* â”€â”€ CONTENT â”€â”€ */
.content {
flex: 1;
overflow-y: auto;
overflow-x: hidden;
-webkit-overflow-scrolling: touch;
padding-bottom: 88px;
}

.panel { display: none; }
.panel.active { display: block; }

/* â”€â”€ BUDGET â”€â”€ */
.budget-col-header {
display: grid;
grid-template-columns: 1fr 88px 88px;
padding: 10px 16px 8px;
position: sticky; top: 0;
background: var(â€“bg); z-index: 5;
border-bottom: 1px solid var(â€“border);
}
.bch { font-size: 9px; letter-spacing: 0.14em; text-transform: uppercase; color: var(â€“sumi-light); }
.bch:not(:first-child) { text-align: right; }

.group-row {
display: grid;
grid-template-columns: 1fr 88px 88px;
padding: 10px 16px;
background: var(â€“bg2);
align-items: center;
cursor: pointer;
user-select: none;
border-top: 1px solid var(â€“border);
}

.group-title {
display: flex; align-items: center; gap: 6px;
font-size: 10px; font-weight: 400;
letter-spacing: 0.13em; text-transform: uppercase;
color: var(â€“sumi-mid);
}

.chevron { font-size: 10px; color: var(â€“sumi-light); transition: transform 0.2s; }
.group-row.closed .chevron { transform: rotate(-90deg); }

.group-num {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 15px; color: var(â€“sumi-mid); text-align: right;
}

.cat-rows.hidden { display: none; }

.cat-row {
display: grid;
grid-template-columns: 1fr 88px 88px;
padding: 12px 16px 12px 28px;
align-items: center;
background: var(â€“card);
border-top: 1px solid rgba(28,28,26,0.05);
cursor: pointer;
transition: background 0.12s;
}
.cat-row:active { background: var(â€“bg2); }
.cat-row.overspent { border-left: 3px solid var(â€“aka-mid); padding-left: 25px; }

.cat-info { display: flex; align-items: center; gap: 9px; min-width: 0; }
.cat-emo { font-size: 16px; flex-shrink: 0; }
.cat-text { min-width: 0; }
.cat-name-text { font-size: 14px; color: var(â€“sumi); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.cat-bar { height: 2px; background: var(â€“border); border-radius: 1px; margin-top: 3px; overflow: hidden; }
.cat-bar-fill { height: 100%; background: var(â€“matcha-light); border-radius: 1px; transition: width 0.3s; }
.cat-bar-fill.over { background: var(â€“aka-mid); }

.cat-assigned {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 17px; text-align: right;
color: var(â€“sumi-mid);
cursor: text; padding: 2px 4px;
border-radius: 4px; position: relative;
}
.cat-assigned.editing { background: var(â€“matcha-pale); outline: 1.5px solid var(â€“matcha); outline-offset: 1px; }

.assign-inp {
position: absolute; inset: 0;
background: none; border: none; outline: none;
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 17px; text-align: right;
color: var(â€“sumi); padding: 0 4px;
display: none; width: 100%;
}

.cat-avail {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 17px; text-align: right; font-weight: 400; padding-right: 2px;
}
.cat-avail.pos { color: var(â€“matcha); }
.cat-avail.neg { color: var(â€“aka-mid); }
.cat-avail.zer { color: var(â€“sumi-xlight); }

.add-cat-row {
padding: 10px 16px 10px 28px;
display: flex; align-items: center; gap: 6px;
background: var(â€“card);
border-top: 1px solid rgba(28,28,26,0.05);
cursor: pointer; color: var(â€“matcha-mid);
font-size: 13px; letter-spacing: 0.04em;
transition: background 0.12s;
}
.add-cat-row:active { background: var(â€“matcha-pale); }

/* â”€â”€ TRANSACTIONS â”€â”€ */
.tx-header-sticky {
padding: 12px 16px 8px;
font-size: 10px; letter-spacing: 0.14em;
text-transform: uppercase; color: var(â€“sumi-light);
background: var(â€“bg);
position: sticky; top: 0; z-index: 4;
border-bottom: 1px solid var(â€“border);
}

.tx-item {
display: flex; align-items: center;
padding: 13px 16px;
background: var(â€“card);
border-top: 1px solid rgba(28,28,26,0.05);
gap: 12px; cursor: pointer;
transition: background 0.12s;
}
.tx-item:active { background: var(â€“bg2); }

.tx-icon {
width: 40px; height: 40px; border-radius: 50%;
background: var(â€“bg2);
display: flex; align-items: center; justify-content: center;
font-size: 17px; flex-shrink: 0; position: relative;
}

.tx-pending-dot {
position: absolute; top: -1px; right: -1px;
width: 10px; height: 10px;
background: var(â€“kinari); border-radius: 50%;
border: 2px solid var(â€“card);
}

.tx-mid { flex: 1; min-width: 0; }
.tx-payee-name { font-size: 14px; color: var(â€“sumi); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.tx-cat-tag { font-size: 12px; color: var(â€“sumi-light); margin-top: 2px; }
.tx-pending-label { color: var(â€“kinari); }

.tx-right { text-align: right; flex-shrink: 0; }
.tx-amt { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 18px; }
.tx-amt.income { color: var(â€“matcha); }
.tx-amt.expense { color: var(â€“sumi); }
.tx-date-str { font-size: 11px; color: var(â€“sumi-xlight); margin-top: 2px; }

/* â”€â”€ GOALS â”€â”€ */
.goals-header {
padding: 14px 16px 12px;
display: flex; justify-content: space-between; align-items: center;
border-bottom: 1px solid var(â€“border);
background: var(â€“bg);
position: sticky; top: 0; z-index: 4;
}
.goals-header-title { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 18px; font-weight: 300; }

.goal-card {
margin: 12px 16px 0;
background: var(â€“card);
border-radius: 14px; padding: 18px;
border: 1px solid var(â€“border);
box-shadow: var(â€“shadow-sm);
cursor: pointer; transition: transform 0.15s;
position: relative; overflow: hidden;
}
.goal-card:active { transform: scale(0.98); }

.goal-stripe { position: absolute; top: 0; left: 0; right: 0; height: 3px; }
.goal-stripe.save { background: var(â€“matcha-mid); }
.goal-stripe.debt { background: var(â€“aka-mid); }
.goal-stripe.spend { background: var(â€“mizu); }

.goal-top { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 12px; }
.goal-emo { font-size: 26px; }

.goal-badge {
font-size: 10px; letter-spacing: 0.1em; text-transform: uppercase;
padding: 3px 9px; border-radius: 10px;
}
.goal-badge.save { background: var(â€“matcha-pale); color: var(â€“matcha); }
.goal-badge.debt { background: var(â€“aka-pale); color: var(â€“aka); }
.goal-badge.spend { background: var(â€“mizu-pale); color: var(â€“mizu); }

.goal-name { font-size: 15px; font-weight: 400; margin-bottom: 2px; }
.goal-sub { font-size: 12px; color: var(â€“sumi-light); margin-bottom: 14px; }

.goal-track { height: 5px; background: var(â€“bg2); border-radius: 3px; overflow: hidden; margin-bottom: 10px; }
.goal-fill { height: 100%; border-radius: 3px; transition: width 0.4s; }
.goal-fill.save { background: var(â€“matcha-mid); }
.goal-fill.debt { background: var(â€“aka-mid); }
.goal-fill.spend { background: var(â€“mizu); }

.goal-stats { display: flex; justify-content: space-between; align-items: flex-end; }
.goal-saved-val { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 22px; }
.goal-target-val { font-size: 12px; color: var(â€“sumi-light); }
.goal-monthly-val { font-size: 12px; }
.goal-monthly-val.save { color: var(â€“matcha); }
.goal-monthly-val.debt { color: var(â€“aka-mid); }
.goal-monthly-val.spend { color: var(â€“mizu); }

/* â”€â”€ REPORTS â”€â”€ */
.report-section { padding: 16px; }
.report-card {
background: var(â€“card); border-radius: 14px;
border: 1px solid var(â€“border); padding: 18px;
margin-bottom: 14px; box-shadow: var(â€“shadow-sm);
}
.report-title {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 17px; font-weight: 300; letter-spacing: 0.04em;
margin-bottom: 16px; color: var(â€“sumi);
}

.ie-row { display: flex; gap: 10px; margin-bottom: 16px; }
.ie-box { flex: 1; background: var(â€“bg); border-radius: 10px; padding: 12px 14px; }
.ie-lbl { font-size: 9px; letter-spacing: 0.14em; text-transform: uppercase; color: var(â€“sumi-light); margin-bottom: 4px; }
.ie-val { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 22px; }
.ie-val.inc { color: var(â€“matcha); }
.ie-val.exp { color: var(â€“aka-mid); }

.bar-chart { display: flex; align-items: flex-end; gap: 5px; height: 70px; }
.bar-wrap { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; height: 100%; justify-content: flex-end; }
.bar-col { width: 100%; background: var(â€“matcha-pale); border-radius: 3px 3px 0 0; cursor: pointer; transition: background 0.2s; }
.bar-col.current { background: var(â€“matcha-mid); }
.bar-lbl { font-size: 9px; color: var(â€“sumi-xlight); }

.spend-list { display: flex; flex-direction: column; gap: 10px; }
.spend-item { display: flex; align-items: center; gap: 10px; }
.spend-lbl { font-size: 13px; width: 110px; flex-shrink: 0; color: var(â€“sumi-mid); }
.spend-trk { flex: 1; height: 5px; background: var(â€“bg2); border-radius: 3px; overflow: hidden; }
.spend-bar { height: 100%; border-radius: 3px; background: var(â€“matcha-mid); }
.spend-val { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 14px; width: 60px; text-align: right; color: var(â€“sumi); }

.age-big { text-align: center; padding: 10px 0; }
.age-num { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 64px; font-weight: 300; color: var(â€“matcha); line-height: 1; }
.age-unit { font-size: 11px; letter-spacing: 0.12em; text-transform: uppercase; color: var(â€“sumi-light); margin-top: 4px; }
.age-desc { font-size: 12px; color: var(â€“sumi-light); margin-top: 10px; line-height: 1.5; }

/* â”€â”€ BOTTOM NAV â”€â”€ */
.bottom-nav {
position: fixed; bottom: 0; left: 50%;
transform: translateX(-50%);
width: 100%; max-width: 480px;
background: var(â€“sumi);
display: flex; z-index: 50;
padding-bottom: env(safe-area-inset-bottom, 0);
border-top: 1px solid rgba(255,255,255,0.06);
}

.nav-tab {
flex: 1; display: flex; flex-direction: column;
align-items: center; justify-content: center;
padding: 10px 4px 12px;
cursor: pointer; color: rgba(255,255,255,0.38);
transition: color 0.15s; border: none; background: none;
gap: 4px;
}
.nav-tab.active { color: var(â€“kinari); }
.nav-tab:active { color: rgba(255,255,255,0.65); }

.nav-icon { font-size: 20px; line-height: 1; }
.nav-label { font-size: 9px; letter-spacing: 0.08em; text-transform: uppercase; font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif; }

/* â”€â”€ FAB â”€â”€ */
.fab {
position: fixed; bottom: 72px;
right: max(16px, calc(50% - 240px + 16px));
width: 52px; height: 52px;
background: var(â€“matcha);
border-radius: 50%;
display: flex; align-items: center; justify-content: center;
font-size: 26px; color: white; cursor: pointer;
box-shadow: 0 4px 16px rgba(74,103,65,0.45);
border: none; z-index: 40;
transition: transform 0.15s, background 0.15s;
}
.fab:active { transform: scale(0.9); background: var(â€“matcha-mid); }

/* â”€â”€ SHEET MODAL â”€â”€ */
.overlay {
position: fixed; inset: 0;
background: rgba(28,28,26,0.55);
backdrop-filter: blur(6px);
-webkit-backdrop-filter: blur(6px);
z-index: 100;
display: flex; align-items: flex-end;
opacity: 0; pointer-events: none;
transition: opacity 0.25s;
}
.overlay.open { opacity: 1; pointer-events: all; }

.sheet {
background: var(â€“card);
border-radius: 20px 20px 0 0;
width: 100%;
padding: 20px 20px calc(20px + env(safe-area-inset-bottom, 0));
transform: translateY(40px);
transition: transform 0.25s;
max-height: 90vh;
overflow-y: auto;
}
.overlay.open .sheet { transform: none; }

.sheet-handle {
width: 36px; height: 4px;
background: var(â€“border-strong);
border-radius: 2px; margin: 0 auto 20px;
}

.sheet-title {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 22px; font-weight: 300;
letter-spacing: 0.04em; margin-bottom: 20px;
}

.form-group { margin-bottom: 14px; }
.form-label {
font-size: 10px; letter-spacing: 0.12em;
text-transform: uppercase; color: var(â€“sumi-light);
display: block; margin-bottom: 6px;
}

.form-input {
width: 100%; background: var(â€“bg2);
border: 1.5px solid transparent; border-radius: 10px;
padding: 12px 14px;
font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
font-size: 15px; color: var(â€“sumi); outline: none;
transition: border-color 0.15s, background 0.15s;
-webkit-appearance: none; appearance: none;
}
.form-input:focus { border-color: var(â€“matcha); background: white; }

.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

.type-row { display: flex; gap: 8px; margin-bottom: 14px; }
.type-chip {
flex: 1; padding: 11px; border-radius: 10px;
border: 1.5px solid var(â€“border-strong);
background: none; cursor: pointer;
font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
font-size: 13px; letter-spacing: 0.06em;
color: var(â€“sumi-light); transition: all 0.15s;
-webkit-appearance: none;
}
.type-chip.a-exp { background: var(â€“aka-pale); border-color: var(â€“aka-mid); color: var(â€“aka); }
.type-chip.a-inc { background: var(â€“matcha-pale); border-color: var(â€“matcha); color: var(â€“matcha); }

.btn-save {
width: 100%; background: var(â€“matcha);
color: white; border: none; border-radius: 12px;
padding: 15px;
font-family: â€˜Zen Kaku Gothic Newâ€™, sans-serif;
font-size: 15px; font-weight: 400; letter-spacing: 0.06em;
cursor: pointer; margin-top: 6px;
transition: background 0.15s; -webkit-appearance: none;
}
.btn-save:active { background: var(â€“matcha-mid); }
.btn-save.small { width: auto; padding: 8px 16px; font-size: 12px; margin: 0; }

/* â”€â”€ TOAST â”€â”€ */
.toast {
position: fixed; bottom: 90px; left: 50%;
transform: translateX(-50%) translateY(10px);
background: var(â€“sumi); color: white;
padding: 9px 20px; border-radius: 20px;
font-size: 13px; letter-spacing: 0.06em;
opacity: 0; pointer-events: none;
transition: all 0.25s; z-index: 200; white-space: nowrap;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

::-webkit-scrollbar { width: 0; }
</style>

</head>
<body>
<div class="app">

  <!-- TOP HEADER -->

  <div class="top-header">
    <div class="top-bar">
      <div class="logo">é–“ Ma</div>
      <div class="month-nav">
        <button class="month-btn" onclick="changeMonth(-1)">â€¹</button>
        <span class="month-label" id="monthLabel"></span>
        <button class="month-btn" onclick="changeMonth(1)">â€º</button>
      </div>
      <button class="header-btn" onclick="openSheet('cat')">ï¼‹</button>
    </div>
    <div class="summary-pills">
      <div class="pill">
        <span class="pill-label">Asignado</span>
        <span class="pill-value" id="s-assigned">â‚¬0</span>
      </div>
      <div class="pill">
        <span class="pill-label">Gastado</span>
        <span class="pill-value amber" id="s-spent">â‚¬0</span>
      </div>
      <div class="pill">
        <span class="pill-label">Disponible</span>
        <span class="pill-value green" id="s-avail">â‚¬0</span>
      </div>
    </div>
  </div>

  <!-- ASSIGN BANNER -->

  <div class="assign-banner">
    <div class="assign-left">
      <span class="assign-label">Para asignar</span>
      <span class="assign-value surplus" id="toAssignVal">â‚¬0,00</span>
    </div>
    <div class="assign-age">
      <div class="assign-age-num" id="ageNum">0</div>
      <div class="assign-age-label">dÃ­as dinero</div>
    </div>
  </div>

  <!-- CONTENT -->

  <div class="content">

```
<div class="panel active" id="panel-budget">
  <div class="budget-col-header">
    <span class="bch">CategorÃ­a</span>
    <span class="bch" style="text-align:right">Asignado</span>
    <span class="bch" style="text-align:right">Disponible</span>
  </div>
  <div id="budgetBody"></div>
</div>

<div class="panel" id="panel-tx">
  <div class="tx-header-sticky">Movimientos del mes</div>
  <div id="txBody"></div>
</div>

<div class="panel" id="panel-goals">
  <div class="goals-header">
    <span class="goals-header-title">Metas financieras</span>
    <button class="btn-save small" onclick="openSheet('goal')">+ Nueva</button>
  </div>
  <div id="goalsBody"></div>
  <div style="height:16px"></div>
</div>

<div class="panel" id="panel-reports">
  <div class="report-section" id="reportsBody"></div>
</div>
```

  </div>

  <!-- FAB -->

<button class="fab" id="fab" onclick="openSheet('tx')">ï¼‹</button>

  <!-- BOTTOM NAV -->

  <nav class="bottom-nav">
    <button class="nav-tab active" id="tab-budget" onclick="showPanel('budget')">
      <span class="nav-icon">âŠž</span>
      <span class="nav-label">Plan</span>
    </button>
    <button class="nav-tab" id="tab-tx" onclick="showPanel('tx')">
      <span class="nav-icon">â‰¡</span>
      <span class="nav-label">Movimientos</span>
    </button>
    <button class="nav-tab" id="tab-goals" onclick="showPanel('goals')">
      <span class="nav-icon">â—Ž</span>
      <span class="nav-label">Metas</span>
    </button>
    <button class="nav-tab" id="tab-reports" onclick="showPanel('reports')">
      <span class="nav-icon">â–¦</span>
      <span class="nav-label">Informes</span>
    </button>
  </nav>
</div>

<!-- TRANSACTION SHEET -->

<div class="overlay" id="overlay-tx">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-title">Nueva transacciÃ³n</div>
    <div class="type-row">
      <button class="type-chip a-exp" id="chip-exp" onclick="setTxType('expense')">Gasto</button>
      <button class="type-chip" id="chip-inc" onclick="setTxType('income')">Ingreso</button>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Fecha</label>
        <input type="date" class="form-input" id="f-date">
      </div>
      <div class="form-group">
        <label class="form-label">Importe â‚¬</label>
        <input type="number" class="form-input" id="f-amount" placeholder="0.00" step="0.01" min="0">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">DescripciÃ³n</label>
      <input type="text" class="form-input" id="f-payee" placeholder="ej. Mercadona">
    </div>
    <div class="form-group" id="f-cat-wrap">
      <label class="form-label">CategorÃ­a</label>
      <select class="form-input" id="f-cat"></select>
    </div>
    <div class="form-group">
      <label class="form-label">Nota (opcional)</label>
      <input type="text" class="form-input" id="f-note" placeholder="">
    </div>
    <button class="btn-save" onclick="saveTx()">Guardar transacciÃ³n</button>
  </div>
</div>

<!-- CATEGORY SHEET -->

<div class="overlay" id="overlay-cat">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-title">Nueva categorÃ­a</div>
    <div class="form-group">
      <label class="form-label">Grupo</label>
      <select class="form-input" id="c-group"></select>
    </div>
    <div class="form-group" id="c-newgroup-wrap">
      <label class="form-label">Nombre del grupo nuevo</label>
      <input type="text" class="form-input" id="c-newgroup" placeholder="ej. Hogar">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Emoji</label>
        <input type="text" class="form-input" id="c-emoji" placeholder="ðŸ“Œ" maxlength="2">
      </div>
      <div class="form-group">
        <label class="form-label">Nombre</label>
        <input type="text" class="form-input" id="c-name" placeholder="ej. Alquiler">
      </div>
    </div>
    <button class="btn-save" onclick="saveCat()">Crear categorÃ­a</button>
  </div>
</div>

<!-- GOAL SHEET -->

<div class="overlay" id="overlay-goal">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-title">Nueva meta</div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Emoji</label>
        <input type="text" class="form-input" id="g-emoji" placeholder="ðŸŽ¯" maxlength="2">
      </div>
      <div class="form-group">
        <label class="form-label">Tipo</label>
        <select class="form-input" id="g-type">
          <option value="save">Ahorro</option>
          <option value="debt">Deuda</option>
          <option value="spend">Gasto futuro</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Nombre</label>
      <input type="text" class="form-input" id="g-name" placeholder="ej. Fondo de emergencia">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Objetivo â‚¬</label>
        <input type="number" class="form-input" id="g-target" placeholder="5000">
      </div>
      <div class="form-group">
        <label class="form-label">Ahorrado â‚¬</label>
        <input type="number" class="form-input" id="g-saved" placeholder="0">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Fecha objetivo</label>
      <input type="month" class="form-input" id="g-date">
    </div>
    <button class="btn-save" onclick="saveGoal()">Crear meta</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const state = {
  month: new Date(),
  income: 3500,
  groups: [
    { id:'g1', name:'Gastos esenciales', open:true, cats:[
      { id:'c1', name:'Alquiler',          emoji:'ðŸ ', assigned:900,  spent:900  },
      { id:'c2', name:'Suministros',       emoji:'ðŸ’¡', assigned:120,  spent:32.5 },
      { id:'c3', name:'Supermercado',      emoji:'ðŸ›’', assigned:350,  spent:267.3},
      { id:'c4', name:'Transporte',        emoji:'ðŸš‡', assigned:80,   spent:26   },
      { id:'c5', name:'TelÃ©fono/Internet', emoji:'ðŸ“¡', assigned:45,   spent:45   },
    ]},
    { id:'g2', name:'Estilo de vida', open:true, cats:[
      { id:'c6', name:'Restaurantes', emoji:'ðŸœ', assigned:150, spent:198  },
      { id:'c7', name:'Ocio',         emoji:'ðŸŽ­', assigned:100, spent:57   },
      { id:'c8', name:'Ropa',         emoji:'ðŸ‘˜', assigned:80,  spent:0    },
      { id:'c9', name:'Salud',        emoji:'âš•ï¸', assigned:60,  spent:25   },
    ]},
    { id:'g3', name:'Verdaderos gastos', open:true, cats:[
      { id:'c10', name:'Vacaciones',    emoji:'âœˆï¸', assigned:150, spent:0 },
      { id:'c11', name:'Mantenimiento', emoji:'ðŸ”§', assigned:50,  spent:0 },
      { id:'c12', name:'Regalos',       emoji:'ðŸŽ', assigned:40,  spent:0 },
    ]},
    { id:'g4', name:'Ahorro y deuda', open:true, cats:[
      { id:'c14', name:'Fondo emergencia', emoji:'ðŸ¦', assigned:200, spent:0   },
      { id:'c15', name:'InversiÃ³n',        emoji:'ðŸ“ˆ', assigned:150, spent:0   },
      { id:'c16', name:'Tarjeta crÃ©dito',  emoji:'ðŸ’³', assigned:100, spent:100 },
    ]},
  ],
  transactions: [
    { id:'t1',  date:'2025-02-15', payee:'Mercadona',     cat:'c3',  amount:87.3,  type:'expense', cleared:true,  note:'' },
    { id:'t2',  date:'2025-02-14', payee:'NÃ³mina febrero',cat:null,  amount:3500,  type:'income',  cleared:true,  note:'' },
    { id:'t3',  date:'2025-02-13', payee:'Ramen Ichiban',  cat:'c6',  amount:32,    type:'expense', cleared:true,  note:'Cena amigos' },
    { id:'t4',  date:'2025-02-12', payee:'Zara Home',      cat:'c8',  amount:54,    type:'expense', cleared:false, note:'' },
    { id:'t5',  date:'2025-02-10', payee:'Farmacia',       cat:'c9',  amount:25,    type:'expense', cleared:true,  note:'' },
    { id:'t6',  date:'2025-02-08', payee:'Metro abono',    cat:'c4',  amount:26,    type:'expense', cleared:true,  note:'' },
    { id:'t7',  date:'2025-02-06', payee:'Netflix',        cat:'c7',  amount:18,    type:'expense', cleared:true,  note:'' },
    { id:'t8',  date:'2025-02-05', payee:'Iberdrola',      cat:'c2',  amount:32.5,  type:'expense', cleared:true,  note:'' },
    { id:'t9',  date:'2025-02-03', payee:'Alquiler feb',   cat:'c1',  amount:900,   type:'expense', cleared:true,  note:'' },
    { id:'t10', date:'2025-02-02', payee:'Sushi Enrique',  cat:'c6',  amount:85,    type:'expense', cleared:false, note:'' },
  ],
  goals: [
    { id:'goal1', name:'Fondo de emergencia', emoji:'ðŸ¦', type:'save',  target:6000, saved:2400, date:'2025-12' },
    { id:'goal2', name:'Viaje a JapÃ³n',        emoji:'ðŸ—¾', type:'save',  target:3000, saved:750,  date:'2026-03' },
    { id:'goal3', name:'Deuda tarjeta',         emoji:'ðŸ’³', type:'debt',  target:1800, saved:1200, date:'2025-06' },
    { id:'goal4', name:'Nuevo portÃ¡til',        emoji:'ðŸ’»', type:'spend', target:1500, saved:300,  date:'2025-09' },
  ],
  txType: 'expense',
};

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MONTHS = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
const fmt  = n => 'â‚¬' + Math.abs(n).toFixed(2).replace('.',',');
const fmtS = n => (n<0?'-':'') + fmt(n);

function getCat(id){
  for(const g of state.groups){ const c = g.cats.find(c=>c.id===id); if(c) return c; }
  return null;
}

function calcTotals(){
  let assigned=0, spent=0;
  for(const g of state.groups) for(const c of g.cats){ assigned+=c.assigned; spent+=c.spent; }
  const avail   = assigned - spent;
  const toAssign = state.income - assigned;

  document.getElementById('s-assigned').textContent = fmt(assigned);
  document.getElementById('s-spent').textContent    = fmt(spent);
  const avEl = document.getElementById('s-avail');
  avEl.textContent = fmtS(avail);
  avEl.className   = 'pill-value ' + (avail<0?'red':avail===0?'amber':'green');

  const taEl = document.getElementById('toAssignVal');
  taEl.textContent = fmtS(toAssign);
  taEl.className   = 'assign-value ' + (toAssign<0?'deficit':'surplus');

  const totalInc = state.transactions.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0);
  const age = spent>0 ? Math.min(Math.round(totalInc/spent*30),90) : 0;
  document.getElementById('ageNum').textContent = age;
}

// â”€â”€â”€ MONTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateMonth(){
  document.getElementById('monthLabel').textContent = MONTHS[state.month.getMonth()] + ' ' + state.month.getFullYear();
}
function changeMonth(d){
  state.month = new Date(state.month.getFullYear(), state.month.getMonth()+d, 1);
  updateMonth();
}

// â”€â”€â”€ PANELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PANELS = ['budget','tx','goals','reports'];
function showPanel(name){
  PANELS.forEach(p=>{
    document.getElementById('panel-'+p).classList.toggle('active', p===name);
    document.getElementById('tab-'+p).classList.toggle('active', p===name);
  });
  document.getElementById('fab').style.display = (name==='reports'||name==='goals') ? 'none' : 'flex';
  if(name==='tx')      renderTx();
  if(name==='goals')   renderGoals();
  if(name==='reports') renderReports();
}

// â”€â”€â”€ BUDGET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderBudget(){
  const body = document.getElementById('budgetBody');
  body.innerHTML = '';

  for(const group of state.groups){
    const gAssigned = group.cats.reduce((s,c)=>s+c.assigned, 0);
    const gSpent    = group.cats.reduce((s,c)=>s+c.spent, 0);
    const gAvail    = gAssigned - gSpent;

    const wrapper = document.createElement('div');
    wrapper.innerHTML = `
      <div class="group-row ${group.open?'open':'closed'}" data-gid="${group.id}">
        <div class="group-title"><span class="chevron">â–¾</span>${group.name}</div>
        <div class="group-num">${fmt(gAssigned)}</div>
        <div class="group-num" style="color:${gAvail<0?'var(--aka-mid)':'var(--sumi-mid)'}">${fmtS(gAvail)}</div>
      </div>
      <div class="cat-rows ${group.open?'':'hidden'}" id="cr-${group.id}"></div>
    `;
    wrapper.querySelector('.group-row').onclick = () => toggleGroup(group.id);
    body.appendChild(wrapper);

    const rows = wrapper.querySelector('.cat-rows');
    for(const cat of group.cats){
      const avail = cat.assigned - cat.spent;
      const pct   = cat.assigned>0 ? Math.min(cat.spent/cat.assigned*100, 100) : 0;
      const over  = avail < 0;

      const row = document.createElement('div');
      row.className = 'cat-row' + (over?' overspent':'');
      row.innerHTML = `
        <div class="cat-info">
          <span class="cat-emo">${cat.emoji}</span>
          <div class="cat-text">
            <div class="cat-name-text">${cat.name}</div>
            <div class="cat-bar"><div class="cat-bar-fill ${over?'over':''}" style="width:${pct}%"></div></div>
          </div>
        </div>
        <div class="cat-assigned" id="ca-${cat.id}">
          <span id="ca-txt-${cat.id}">${fmt(cat.assigned)}</span>
          <input class="assign-inp" id="inp-${cat.id}" type="number" min="0" step="0.01">
        </div>
        <div class="cat-avail ${over?'neg':avail===0&&cat.assigned>0?'zer':'pos'}">${fmtS(avail)}</div>
      `;
      row.querySelector('.cat-assigned').onclick = e => startEdit(cat.id, e);
      const inp = row.querySelector('.assign-inp');
      inp.onblur = () => endEdit(cat.id);
      inp.onkeydown = e => { if(e.key==='Enter') endEdit(cat.id); if(e.key==='Escape') cancelEdit(cat.id); };
      rows.appendChild(row);
    }

    const addRow = document.createElement('div');
    addRow.className = 'add-cat-row';
    addRow.textContent = 'ï¼‹ aÃ±adir categorÃ­a';
    addRow.onclick = () => openSheet('cat');
    rows.appendChild(addRow);
  }
  calcTotals();
}

function toggleGroup(id){
  const g = state.groups.find(g=>g.id===id);
  if(!g) return;
  g.open = !g.open;
  renderBudget();
}

function startEdit(catId, e){
  e.stopPropagation();
  const el  = document.getElementById('ca-'+catId);
  const inp = document.getElementById('inp-'+catId);
  const cat = getCat(catId);
  el.classList.add('editing');
  document.getElementById('ca-txt-'+catId).style.display = 'none';
  inp.style.display = 'block';
  inp.value = cat.assigned;
  inp.focus(); inp.select();
}

function endEdit(catId){
  const el  = document.getElementById('ca-'+catId);
  const inp = document.getElementById('inp-'+catId);
  const cat = getCat(catId);
  if(!inp || !el) return;
  cat.assigned = parseFloat(inp.value) || 0;
  el.classList.remove('editing');
  inp.style.display = 'none';
  renderBudget();
  showToast('AsignaciÃ³n actualizada âœ“');
}

function cancelEdit(catId){
  const el  = document.getElementById('ca-'+catId);
  const inp = document.getElementById('inp-'+catId);
  if(!el||!inp) return;
  el.classList.remove('editing');
  inp.style.display = 'none';
  document.getElementById('ca-txt-'+catId).style.display = '';
}

// â”€â”€â”€ TRANSACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTx(){
  const body   = document.getElementById('txBody');
  const sorted = [...state.transactions].sort((a,b)=>b.date.localeCompare(a.date));

  body.innerHTML = sorted.map(tx => {
    const cat = tx.cat ? getCat(tx.cat) : null;
    const d   = new Date(tx.date+'T12:00:00');
    const ds  = d.toLocaleDateString('es-ES',{day:'2-digit',month:'short'});
    const icon = cat ? cat.emoji : (tx.type==='income'?'ðŸ’°':'ðŸ’¸');
    const catLabel = cat ? cat.name : (tx.type==='income'?'Ingreso':'Sin categorÃ­a');

    return `
      <div class="tx-item">
        <div class="tx-icon">
          ${icon}
          ${!tx.cleared ? '<div class="tx-pending-dot"></div>' : ''}
        </div>
        <div class="tx-mid">
          <div class="tx-payee-name">${tx.payee}</div>
          <div class="tx-cat-tag">${catLabel}${!tx.cleared?' Â· <span class="tx-pending-label">pendiente</span>':''}${tx.note?' Â· '+tx.note:''}</div>
        </div>
        <div class="tx-right">
          <div class="tx-amt ${tx.type}">${tx.type==='income'?'+':'âˆ’'}${fmt(tx.amount)}</div>
          <div class="tx-date-str">${ds}</div>
        </div>
      </div>
    `;
  }).join('');
}

// â”€â”€â”€ GOALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderGoals(){
  const body = document.getElementById('goalsBody');
  const labels = {save:'Ahorro', debt:'Deuda', spend:'Gasto futuro'};

  body.innerHTML = state.goals.map(g => {
    const pct  = Math.min(g.saved/g.target*100, 100);
    const rem  = g.target - g.saved;
    const tD   = new Date(g.date+'-01');
    const now  = new Date();
    const mL   = Math.max(1,(tD.getFullYear()-now.getFullYear())*12+tD.getMonth()-now.getMonth());
    const mon  = rem>0 ? (rem/mL).toFixed(0) : 0;

    return `
      <div class="goal-card">
        <div class="goal-stripe ${g.type}"></div>
        <div class="goal-top">
          <span class="goal-emo">${g.emoji}</span>
          <span class="goal-badge ${g.type}">${labels[g.type]}</span>
        </div>
        <div class="goal-name">${g.name}</div>
        <div class="goal-sub">Objetivo: ${g.date} Â· ${pct.toFixed(0)}% completado</div>
        <div class="goal-track"><div class="goal-fill ${g.type}" style="width:${pct}%"></div></div>
        <div class="goal-stats">
          <div>
            <div class="goal-saved-val">${fmt(g.saved)}</div>
            <div class="goal-target-val">de ${fmt(g.target)}</div>
          </div>
          <div class="goal-monthly-val ${g.type}">â‚¬${mon}/mes</div>
        </div>
      </div>
    `;
  }).join('');
}

// â”€â”€â”€ REPORTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderReports(){
  const body = document.getElementById('reportsBody');

  let cats = [];
  for(const g of state.groups) for(const c of g.cats) if(c.spent>0) cats.push(c);
  cats.sort((a,b)=>b.spent-a.spent);
  const maxS = cats[0]?.spent || 1;

  const totalInc = state.transactions.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount, 0);
  const totalExp = state.transactions.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount, 0);

  const bars   = [1800,2100,2450,1950,2800,totalExp];
  const barMax = Math.max(...bars);
  const barLbl = Array.from({length:6},(_,i)=>{
    const mn = new Date(state.month.getFullYear(), state.month.getMonth()-5+i, 1);
    return MONTHS[mn.getMonth()].slice(0,3);
  });

  const age = totalExp>0 ? Math.min(Math.round(totalInc/totalExp*30),90) : 0;

  body.innerHTML = `
    <div class="report-card">
      <div class="report-title">Ingresos vs Gastos</div>
      <div class="ie-row">
        <div class="ie-box"><div class="ie-lbl">Ingresos</div><div class="ie-val inc">${fmt(totalInc)}</div></div>
        <div class="ie-box"><div class="ie-lbl">Gastos</div><div class="ie-val exp">${fmt(totalExp)}</div></div>
      </div>
      <div style="font-size:9px;letter-spacing:.12em;text-transform:uppercase;color:var(--sumi-xlight);margin-bottom:8px">Ãšltimos 6 meses</div>
      <div class="bar-chart">
        ${bars.map((v,i)=>`
          <div class="bar-wrap">
            <div class="bar-col ${i===5?'current':''}" style="height:${v/barMax*100}%" title="${fmt(v)}"></div>
            <div class="bar-lbl">${barLbl[i]}</div>
          </div>
        `).join('')}
      </div>
    </div>

    <div class="report-card">
      <div class="report-title">Gasto por categorÃ­a</div>
      <div class="spend-list">
        ${cats.slice(0,7).map(c=>`
          <div class="spend-item">
            <div class="spend-lbl">${c.emoji} ${c.name}</div>
            <div class="spend-trk"><div class="spend-bar" style="width:${c.spent/maxS*100}%"></div></div>
            <div class="spend-val">${fmt(c.spent)}</div>
          </div>
        `).join('')}
      </div>
    </div>

    <div class="report-card">
      <div class="report-title">Edad del dinero</div>
      <div class="age-big">
        <div class="age-num">${age}</div>
        <div class="age-unit">dÃ­as de media</div>
        <div class="age-desc">Cuanto mayor, mÃ¡s estable tu economÃ­a.<br>Objetivo: superar los 30 dÃ­as.</div>
      </div>
    </div>
  `;
}

// â”€â”€â”€ SHEETS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openSheet(name){
  if(name==='tx'){
    document.getElementById('f-date').value = new Date().toISOString().split('T')[0];
    document.getElementById('f-amount').value = '';
    document.getElementById('f-payee').value  = '';
    document.getElementById('f-note').value   = '';
    const sel = document.getElementById('f-cat');
    sel.innerHTML = '<option value="">â€” Sin categorÃ­a â€”</option>';
    for(const g of state.groups){
      const og = document.createElement('optgroup'); og.label = g.name;
      for(const c of g.cats){
        const o = document.createElement('option'); o.value = c.id; o.textContent = c.emoji+' '+c.name; og.appendChild(o);
      }
      sel.appendChild(og);
    }
    setTxType('expense');
  }
  if(name==='cat'){
    const sel = document.getElementById('c-group');
    sel.innerHTML = '<option value="">â€” Nuevo grupo â€”</option>';
    for(const g of state.groups){
      const o = document.createElement('option'); o.value = g.id; o.textContent = g.name; sel.appendChild(o);
    }
    sel.onchange = () => {
      document.getElementById('c-newgroup-wrap').style.display = sel.value ? 'none' : 'block';
    };
    document.getElementById('c-newgroup-wrap').style.display = 'block';
    document.getElementById('c-name').value  = '';
    document.getElementById('c-emoji').value = '';
    document.getElementById('c-newgroup').value = '';
  }
  if(name==='goal'){
    ['g-name','g-emoji','g-target','g-saved','g-date'].forEach(id => document.getElementById(id).value = '');
  }
  document.getElementById('overlay-'+name).classList.add('open');
}

function closeSheet(name){
  document.getElementById('overlay-'+name).classList.remove('open');
}

['tx','cat','goal'].forEach(n=>{
  document.getElementById('overlay-'+n).addEventListener('click', e=>{
    if(e.target === document.getElementById('overlay-'+n)) closeSheet(n);
  });
});

function setTxType(type){
  state.txType = type;
  document.getElementById('chip-exp').className = 'type-chip' + (type==='expense'?' a-exp':'');
  document.getElementById('chip-inc').className = 'type-chip' + (type==='income'?' a-inc':'');
  document.getElementById('f-cat-wrap').style.display = type==='income' ? 'none' : 'block';
}

function saveTx(){
  const amount = parseFloat(document.getElementById('f-amount').value) || 0;
  const payee  = document.getElementById('f-payee').value.trim();
  if(!payee || amount<=0){ showToast('Completa importe y descripciÃ³n'); return; }

  const cat = state.txType==='income' ? null : (document.getElementById('f-cat').value || null);
  const tx  = {
    id: 't'+Date.now(),
    date:    document.getElementById('f-date').value,
    payee, cat, amount,
    type:    state.txType,
    cleared: false,
    note:    document.getElementById('f-note').value,
  };

  if(tx.type==='expense' && cat){ const c = getCat(cat); if(c) c.spent += amount; }
  if(tx.type==='income') state.income += amount;

  state.transactions.unshift(tx);
  closeSheet('tx');
  renderBudget();
  if(document.getElementById('panel-tx').classList.contains('active')) renderTx();
  showToast('TransacciÃ³n guardada âœ“');
}

function saveCat(){
  const gSel  = document.getElementById('c-group').value;
  const name  = document.getElementById('c-name').value.trim();
  const emoji = document.getElementById('c-emoji').value || 'ðŸ“Œ';
  if(!name){ showToast('Escribe un nombre'); return; }

  const newCat = { id:'c'+Date.now(), name, emoji, assigned:0, spent:0 };
  if(gSel){
    const g = state.groups.find(g=>g.id===gSel); if(g) g.cats.push(newCat);
  } else {
    const gName = document.getElementById('c-newgroup').value.trim() || 'Nuevo grupo';
    state.groups.push({ id:'g'+Date.now(), name:gName, open:true, cats:[newCat] });
  }
  closeSheet('cat');
  renderBudget();
  showToast('CategorÃ­a creada âœ“');
}

function saveGoal(){
  const name   = document.getElementById('g-name').value.trim();
  const target = parseFloat(document.getElementById('g-target').value) || 0;
  const saved  = parseFloat(document.getElementById('g-saved').value)  || 0;
  if(!name || target<=0){ showToast('Nombre y objetivo obligatorios'); return; }

  state.goals.push({
    id: 'goal'+Date.now(), name,
    emoji: document.getElementById('g-emoji').value || 'ðŸŽ¯',
    type:  document.getElementById('g-type').value,
    target, saved,
    date:  document.getElementById('g-date').value || '2026-12',
  });
  closeSheet('goal');
  renderGoals();
  showToast('Meta creada âœ“');
}

// â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg){
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'), 2200);
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
updateMonth();
renderBudget();
</script>

</body>
</html>
